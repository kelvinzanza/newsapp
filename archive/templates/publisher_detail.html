{% extends 'base.html' %}
{% load archive_tags %}
{% load subscription_tags %}

{% block title %}Publisher: {{ publisher.name }}{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-8 max-w-4xl">
    <div class="bg-white p-8 rounded-lg shadow-md">
        <h1 class="text-4xl font-bold text-gray-800 mb-4">{{ publisher.name }}</h1>
        <p class="text-gray-600 mb-6">{{ publisher.description }}</p>

        {% load subscription_tags %}
        {% if user.is_authenticated and user|is_reader %}
            {% if user|is_subscribed_to_publisher:publisher %}
                <form action="{% url 'unsubscribe_from_publisher' publisher.pk %}" method="post">
                    {% csrf_token %}
                    <button type="submit" class="bg-red-500 text-white font-semibold py-2 px-4 rounded-lg hover:bg-red-600 transition duration-300">Unsubscribe</button>
                </form>
            {% else %}
                <form action="{% url 'subscribe_to_publisher' publisher.pk %}" method="post">
                    {% csrf_token %}
                    <button type="submit" class="bg-green-600 text-white font-semibold py-2 px-4 rounded-lg hover:bg-green-700 transition duration-300">Subscribe</button>
                </form>
            {% endif %}
        {% endif %}
        <div class="mb-8 mt-8"> <h2 class="text-2xl font-semibold text-gray-700 mb-3">Editors</h2>
            {% if publisher.editors.all %}
                <ul class="list-disc list-inside text-gray-600">
                    {% for editor in publisher.editors.all %}
                        <li>{{ editor.username }}</li>
                    {% empty %}
                        <li class="text-gray-400">No editors assigned yet.</li>
                    {% endfor %}
                </ul>
            {% else %}
                <p class="text-gray-400">No editors assigned yet.</p>
            {% endif %}
        </div>

        <div>
            <h2 class="text-2xl font-semibold text-gray-700 mb-3">Journalists</h2>
            {% if publisher.journalists.all %}
                <ul class="list-disc list-inside text-gray-600">
                    {% for journalist in publisher.journalists.all %}
                        <li>
                            <a href="{% url 'articles_by_journalist' journalist.username %}" 
                               class="text-indigo-600 hover:underline">
                               {{ journalist.username }}
                            </a>
                        </li>
                    {% empty %}
                        <li class="text-gray-400">No journalists assigned yet.</li>
                    {% endfor %}
                </ul>
            {% else %}
                <p class="text-gray-400">No journalists assigned yet.</p>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}